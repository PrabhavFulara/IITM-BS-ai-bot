<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IITM BS Data Science AI Chatbot</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap" rel="stylesheet">
<style>
  /* Basic reset and body */
  * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
  html, body { height: 100%; overflow: hidden; }

  /* Animated gradient background */
  body {
    background: linear-gradient(-45deg, #00c6ff, #9b59b6, #ff6f61, #f7b733, #23d5ab, #4b79a1);
    background-size: 600% 600%;
    animation: gradientBG 10s ease-in-out infinite;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px;
  }
  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  /* Container for chatbot */
  #container {
    width: 100%;
    max-width: 450px;
    height: 90%;
    display: flex;
    flex-direction: column;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.3);
  }

  /* Intro form */
  #intro {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  .intro-title {
    margin-bottom: 100px;
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 800;
    letter-spacing: 0.6px;
    font-size: clamp(24px, 8vw, 36px);
    background: linear-gradient(90deg, #d2ffd1 0%, #ffdaf8 25%, #bffff4 50%, #fff7c6 75%, #dcfaff 100%);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: titleGradient 10s ease-in-out infinite, titleGlow 3.2s ease-in-out infinite, titleContrast 10s ease-in-out infinite;
    text-shadow: none;
    will-change: background-position, filter;
    -webkit-text-stroke: 0.5px rgba(0,0,0,0.18);
  }
  .intro-title::after {
    content: "";
    display: block;
    width: min(180px, 60%);
    height: 4px;
    margin: 8px auto 0;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(255,255,255,0.7), rgba(255,255,255,0.15));
  }
  @keyframes titleGradient { 0% { background-position: 0% 50% } 50% { background-position: 100% 50% } 100% { background-position: 0% 50% } }
  @keyframes titleGlow { 0%,100% { text-shadow: 0 0 0 rgba(255,255,255,0.0) } 50% { text-shadow: 0 6px 24px rgba(255,255,255,0.25) } }
  /* Invert title gradient mid-cycle to keep contrast against bg */

  #intro input {
    width: 80%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(10px);
    color: #ffffff;
    font-weight: 600;
    text-shadow: 0 1px 1px rgba(0,0,0,0.25);
    text-align: center;
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    caret-color: #eaf3ff;
  }
  #intro input::placeholder { color: rgba(255,255,255,0.9); font-weight: 600; letter-spacing: 0.2px; }
  #intro input:focus { outline: none; box-shadow: 0 0 0 2px rgba(255,255,255,0.35) inset, 0 6px 20px rgba(0,0,0,0.18); }
  #intro button {
    padding: 12px 25px;
    border: none;
    border-radius: 20px;
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(10px);
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    transition: 0.3s;
  }
  #intro button:hover { background: rgba(255,255,255,0.4); }

  /* Modern start button styling */
  #start-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 26px;
    border-radius: 999px;
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    border: 1px solid rgba(255,255,255,0.35);
    color: #ffffff;
    font-weight: 800;
    letter-spacing: 0.3px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.28), inset 0 1px 0 rgba(255,255,255,0.35);
    transition: transform .15s ease, box-shadow .15s ease, background .3s ease;
  }
  #start-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 28px rgba(0,0,0,0.32), inset 0 1px 0 rgba(255,255,255,0.4);
  }
  #start-btn:active {
    transform: translateY(0);
    box-shadow: 0 8px 18px rgba(0,0,0,0.26), inset 0 1px 0 rgba(255,255,255,0.32);
  }
  #start-btn:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255,255,255,0.6), 0 14px 28px rgba(0,0,0,0.32), inset 0 1px 0 rgba(255,255,255,0.4);
  }
  #start-btn::after {
    content: '‚Üí';
    font-weight: 800;
    font-size: 16px;
  }

  /* Chat UI */
  #chat { display: none; flex: 1; flex-direction: column; min-height: 0; }
  #chat-header { padding: 10px 14px; border-bottom: 1px solid rgba(255,255,255,0.2); background: linear-gradient(160deg, rgba(255,255,255,0.20), rgba(180,200,220,0.15), rgba(120,150,180,0.10), rgba(60,100,140,0.08)); backdrop-filter: blur(18px) saturate(140%); -webkit-backdrop-filter: blur(18px) saturate(140%); }
  .chat-title { margin: 0; text-align: center; font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 800; letter-spacing: 0.8px; font-size: clamp(16px, 6vw, 22px); color: transparent; -webkit-text-stroke: 0.4px rgba(255,255,255,0.9); text-shadow: 0 0 10px rgba(0, 0, 0, 0.12), 0 2px 18px rgba(0,0,0,0.25); }
  #chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; scroll-behavior: smooth; -ms-overflow-style: none; scrollbar-width: none; }
  #chat-container::-webkit-scrollbar { display: none; }
  .message { max-width: 70%; margin-bottom: 10px; padding: 10px 15px; border-radius: 20px; word-wrap: break-word; animation: fadeIn 0.3s; border: 1px solid rgba(255,255,255,0.28); backdrop-filter: blur(12px) saturate(140%); -webkit-backdrop-filter: blur(12px) saturate(140%); box-shadow: 0 6px 18px rgba(0,0,0,0.25); }
  .user { align-self: flex-end; background: linear-gradient(160deg, rgba(255,255,255,0.30), rgba(200,220,255,0.18), rgba(150,180,220,0.12), rgba(100,140,180,0.08)); color: #001018; }
  .bot { align-self: flex-start; background: linear-gradient(160deg, rgba(255,255,255,0.26), rgba(220,200,255,0.16), rgba(180,150,220,0.10), rgba(140,100,180,0.06)); color: #000; }
  #input-container { position: sticky; bottom: 0; left: 0; right: 0; z-index: 5; display: flex; gap: 8px; padding: 10px; border-top: 1px solid rgba(255,255,255,0.2); background: linear-gradient(160deg, rgba(255,255,255,0.20), rgba(200,220,240,0.15), rgba(150,180,200,0.10), rgba(100,140,160,0.08)); backdrop-filter: blur(18px) saturate(140%); -webkit-backdrop-filter: blur(18px) saturate(140%); }
  #user-input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.28); background: linear-gradient(160deg, rgba(255,255,255,0.28), rgba(220,240,255,0.20), rgba(180,200,220,0.15), rgba(140,160,180,0.12)); color: #fff; box-shadow: 0 8px 22px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.3); transition: transform .15s ease, box-shadow .15s ease; outline: none; }
  #user-input:hover, #user-input:focus { border-color: rgba(255,255,255,0.38); box-shadow: 0 10px 26px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.36); }
  #send-btn { margin-left: 8px; padding: 12px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.28); background: linear-gradient(160deg, rgba(255,255,255,0.28), rgba(240,220,255,0.20), rgba(200,180,220,0.15), rgba(160,140,180,0.12)); color: #fff; cursor: pointer; box-shadow: 0 8px 22px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.3); transition: transform .15s ease, box-shadow .15s ease; outline: none; }
  #send-btn:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.36); }
  #send-btn:active { transform: translateY(0); box-shadow: 0 6px 18px rgba(0,0,0,0.24), inset 0 1px 0 rgba(255,255,255,0.28); }
  #send-btn:hover, #send-btn:focus { border-color: rgba(255,255,255,0.38); }

  /* Floating Instagram icon */
  #insta-float { position: fixed; right: 16px; top: 95px; width: 52px; height: 52px; border-radius: 50%; display: grid; place-items: center; background: linear-gradient(160deg, rgba(255,255,255,0.28), rgba(220,240,255,0.20), rgba(180,200,220,0.15), rgba(140,160,180,0.12)); border: 1px solid rgba(255,255,255,0.28); backdrop-filter: blur(14px) saturate(140%); -webkit-backdrop-filter: blur(14px) saturate(140%); box-shadow: 0 10px 28px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.36); animation: floaty 3.2s ease-in-out infinite; z-index: 20; }
  #insta-float:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 14px 32px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.4); }
  @keyframes floaty { 0%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } 100%{ transform: translateY(0) } }

  /* Leaderboard floating icon */
  #leaderboard-float { position: fixed; right: 16px; top: 159px; width: 52px; height: 52px; border-radius: 50%; display: none; place-items: center; background: linear-gradient(160deg, rgba(255,255,255,0.28), rgba(240,220,255,0.20), rgba(200,180,220,0.15), rgba(160,140,180,0.12)); border: 1px solid rgba(255,255,255,0.28); backdrop-filter: blur(14px) saturate(140%); -webkit-backdrop-filter: blur(14px) saturate(140%); box-shadow: 0 10px 28px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.36); z-index: 20; animation: floaty 3.2s ease-in-out infinite; cursor: pointer; }
  #leaderboard-float:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 14px 32px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.4); }
  #leaderboard-float .badge { position: absolute; top: -6px; right: -6px; min-width: 20px; height: 20px; padding: 0 6px; border-radius: 999px; background: #ff6f61; color: #fff; font-size: 12px; display: grid; place-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
  /* Golden shine animation */
  #leaderboard-float { position: fixed; }
  #leaderboard-float::after { content: ""; position: absolute; inset: -3px; border-radius: 50%; box-shadow: 0 0 14px 4px rgba(255,215,0,0.42); opacity: 0.7; filter: blur(0.5px); animation: goldenGlow 2.2s ease-in-out infinite; pointer-events: none; }
  #leaderboard-float .emoji-trophy { font-size: 22px; filter: drop-shadow(0 0 6px rgba(255,215,0,0.7)); }
  @keyframes goldenGlow { 0%,100% { box-shadow: 0 0 10px 2px rgba(255,215,0,0.35) } 50% { box-shadow: 0 0 18px 6px rgba(255,215,0,0.6) } }

  /* Leaderboard modal */
  #lb-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.45); z-index: 30; }
  #lb-card { position: relative; width: min(92vw, 420px); border-radius: 18px; padding: 18px; background: linear-gradient(160deg, rgba(255,255,255,0.30), rgba(220,240,255,0.22), rgba(180,200,220,0.18), rgba(140,160,180,0.12)); border: 1px solid rgba(255,255,255,0.28); backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%); color: #041126; box-shadow: 0 20px 46px rgba(0,0,0,0.4); }
  #lb-title { color: #fff; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
  #lb-list { list-style: none; margin: 10px 0 0; padding: 0; }
  #lb-list li { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 8px 10px; margin: 6px 0; border-radius: 12px; background: rgba(255,255,255,0.16); color: #041126; }
  .score-wrap { display: inline-flex; align-items: center; gap: 8px; }
  #lb-sub { margin-top: 4px; color: #eaf3ff; font-size: 12px; opacity: 0.9; }
  #lb-pagination { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; gap: 10px; }
  #lb-prev, #lb-next { padding: 6px 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.28); background: linear-gradient(160deg, rgba(255,255,255,0.30), rgba(220,240,255,0.22), rgba(180,200,220,0.18), rgba(140,160,180,0.14)); color: #fff; cursor: pointer; }
  #lb-page { color: #eaf3ff; font-size: 12px; }
  #lb-close { position: absolute; top: 10px; right: 10px; width: 28px; height: 28px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.4); background: linear-gradient(160deg, rgba(255,255,255,0.45), rgba(240,220,255,0.30), rgba(200,180,220,0.25), rgba(160,140,180,0.18)); color: #041126; cursor: pointer; display: grid; place-items: center; box-shadow: 0 6px 14px rgba(0,0,0,0.25); font-size: 16px; line-height: 1; }

  /* Share gate modal */
  #share-gate { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; z-index: 30; }
  #share-card { width: min(92vw, 420px); border-radius: 18px; padding: 18px; background: linear-gradient(160deg, rgba(255,255,255,0.30), rgba(220,240,255,0.22), rgba(180,200,220,0.18), rgba(140,160,180,0.12)); border: 1px solid rgba(255,255,255,0.28); backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%); color: #041126; box-shadow: 0 20px 46px rgba(0,0,0,0.4); }
  #share-card h3 { margin-bottom: 8px; color: #fff }
  #share-card p { margin-bottom: 12px; color: #eaf3ff }
  .actions { display: flex; gap: 10px; flex-wrap: wrap; }
  .btn-glass { padding: 10px 14px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.28); background: linear-gradient(160deg, rgba(255,255,255,0.30), rgba(220,240,255,0.22), rgba(180,200,220,0.18), rgba(140,160,180,0.14)); color: #fff; cursor: pointer; box-shadow: 0 8px 22px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.3); transition: transform .15s ease, box-shadow .15s ease; outline: none; }
  .btn-glass:hover { transform: translateY(-1px); box-shadow: 0 12px 26px rgba(0,0,0,0.32), inset 0 1px 0 rgba(255,255,255,0.36); border-color: rgba(255,255,255,0.38); }

  /* Simple footer text below input bar */
  #made-by { position: fixed; left: 50%; bottom: 15px; transform: translateX(-50%); font-size: clamp(11px, 2.8vw, 12px); color: rgba(255,255,255,0.9); letter-spacing: 0.3px; z-index: 4; pointer-events: none; text-shadow: 0 2px 10px rgba(0,0,0,0.25); }
  #made-by .creator-name { background: linear-gradient(90deg, #ffe6a7, #ffd1f3, #bffaff, #e6e0ff, #ffe6a7); background-size: 220% 220%; -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-stroke: 0.4px rgba(255,255,255,0.35); animation: madeByShimmer 8s ease-in-out infinite; }
  #made-by .heart { display: inline-block; filter: drop-shadow(0 0 4px rgba(255,0,80,0.6)); animation: heartBeat 1.8s ease-in-out infinite; }
  @keyframes madeByShimmer { 0% { background-position: 0% 50% } 50% { background-position: 100% 50% } 100% { background-position: 0% 50% } }
  @keyframes heartBeat { 0%,100% { transform: scale(1); } 20% { transform: scale(1.06); } 40% { transform: scale(0.98); } 60% { transform: scale(1.05); } 80% { transform: scale(1); } }

  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  /* Typing effect */
  .typing { display: inline-block; border-right: 2px solid #fff; animation: blink 1s steps(1) infinite; }
  @keyframes blink { 50% { border-color: transparent; } }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    body { animation: none; }
    #insta-float, #leaderboard-float { animation: none; }
    .intro-title { animation: none; }
    #leaderboard-float::after { animation: none; }
    #made-by .creator-name { animation: none; }
    #made-by .heart { animation: none; }
    #chat-container { scroll-behavior: auto; }
  }

 
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<div id="container">
  <div id="intro">
    <h2 class="intro-title">First IITM BS AI Bot</h2>
    <input type="text" id="name" placeholder="Your Name (optional)">
    <input type="text" id="whatsapp" placeholder="WhatsApp Number (optional)">
    <button id="start-btn">Start Chat</button>
  </div>

  <div id="chat">
    <div id="chat-header"><h1 class="chat-title">IITM BS AI Bot</h1></div>
    <div id="chat-container" role="log" aria-live="polite" aria-relevant="additions"></div>
    <div id="input-container">
      <input type="text" id="user-input" placeholder="Ask anything about your degree...">
      <button id="send-btn">Send</button>
    </div>
  </div>
      </div>

<!-- Floating Instagram link (hidden until chat starts) -->
<a id="insta-float" href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Follow on Instagram" aria-hidden="true" style="display:none">
  <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
    <path fill="#E1306C" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.51 5.51 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5z"/>
    <circle cx="18.5" cy="5.5" r="1.5" fill="#E1306C"/>
  </svg>
  </a>

<!-- Leaderboard floating button (appears after chat starts) -->
<button id="leaderboard-float" aria-label="Open leaderboard" title="Leaderboard">
  <span class="emoji-trophy" aria-hidden="true">üèÜ</span>
  <span class="badge" id="lb-badge">0</span>
  </button>

<!-- Leaderboard modal -->
<div id="lb-modal" role="dialog" aria-modal="true" aria-labelledby="lb-title">
  <div id="lb-card">
    <button id="lb-close" aria-label="Close leaderboard" title="Close">√ó</button>
    <h3 id="lb-title">üèÜ Top Students</h3>
    <div id="lb-sub">Ranking is based on number of queries asked to the bot.</div>
    <ul id="lb-list"></ul>
    <div id="lb-pagination">
      <button id="lb-prev" aria-label="Previous page">Prev</button>
      <span id="lb-page">Page 1/1</span>
      <button id="lb-next" aria-label="Next page">Next</button>
    </div>
  </div>
    </div>

<!-- Share gate modal -->
<div id="share-gate" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
  <div id="share-card">
    <h3 id="shareTitle">Unlock access in 30 seconds ‚ú®</h3>
    <p>Share this AI assistant with at least 5 friends on WhatsApp to continue chatting. It helps more IITM aspirants discover it.</p>
    <div class="actions">
      <button class="btn-glass" id="btn-share">Share on WhatsApp</button>
      <button class="btn-glass" id="btn-shared">I have shared to 5 people ‚úÖ</button>
      <button class="btn-glass" id="btn-learn-yes">I want to learn no‚Äëcode AI bots</button>
      <button class="btn-glass" id="btn-close-gate">Maybe later</button>
      </div>
    <p style="margin-top:10px;color:#cfe6ff">Tip: After sharing, click "I have shared" to resume.</p>
    </div>
  </div>

<!-- Simple footer note -->
<div id="made-by">madeBy{<span class="creator-name">Prabhav Fulara</span>} with <span class="heart">‚ù§</span></div>

<script>
  // Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyAwWFZHuVh3tFL1yRnPttmh-XDVS-ieok0",
  authDomain: "aibotiitmbs.firebaseapp.com",
  databaseURL: "https://aibotiitmbs-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "aibotiitmbs",
  storageBucket: "aibotiitmbs.firebasestorage.app",
  messagingSenderId: "1039563199522",
  appId: "1:1039563199522:web:95db9b70730cbf6376267b"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Intro form
  const intro = document.getElementById('intro');
  const chatUI = document.getElementById('chat');
  const startBtn = document.getElementById('start-btn');
  const instaFloat = document.getElementById('insta-float');
  const lbFloat = document.getElementById('leaderboard-float');
  const lbBadge = document.getElementById('lb-badge');
  const lbModal = document.getElementById('lb-modal');
  const lbClose = document.getElementById('lb-close');
  const lbList = document.getElementById('lb-list');
  const lbPrev = document.getElementById('lb-prev');
  const lbNext = document.getElementById('lb-next');
  const lbPageInfo = document.getElementById('lb-page');
  let currentUserName = '';
  let sessionMsgCount = 0;
  let lbAllRows = [];
  let lbPage = 0;
  const lbPageSize = 10;

  // Placeholder typing animation for intro inputs
  const nameInput = document.getElementById('name');
  const waInput = document.getElementById('whatsapp');
  function createPlaceholderTyper(inputEl, scriptText) {
    let idx = 0; let timer = null; let caretTimer = null; let showCaret = true; let running = false;
    const base = scriptText;
    function step() {
      if (!running) return;
      const current = base.slice(0, idx) + (showCaret ? ' ‚ñç' : '');
      inputEl.setAttribute('placeholder', current);
      idx += 1;
      if (idx <= base.length) {
        timer = setTimeout(step, 100);
      } else {
        // hold full text, then reset
        timer = setTimeout(() => { idx = 0; step(); }, 1200);
      }
    }
    function start() {
      if (running) return; running = true;
      caretTimer = setInterval(() => { showCaret = !showCaret; }, 450);
      step();
    }
    function stop() {
      running = false;
      if (timer) { clearTimeout(timer); timer = null; }
      if (caretTimer) { clearInterval(caretTimer); caretTimer = null; }
    }
    return { start, stop };
  }
  const nameTyper = createPlaceholderTyper(nameInput, 'Your Name (ex, Riya )');
  const waTyper = createPlaceholderTyper(waInput, 'WhatsApp Number (ex, 9876543210)');
  // Start typing demo
  nameTyper.start();
  waTyper.start();
  // Pause when user interacts
  [nameInput, waInput].forEach((el, i) => {
    const typer = i === 0 ? nameTyper : waTyper;
    el.addEventListener('focus', () => typer.stop());
    el.addEventListener('input', () => typer.stop());
    el.addEventListener('blur', () => { if (!el.value.trim()) typer.start(); });
  });
  startBtn.onclick = () => {
    const name = document.getElementById('name').value.trim();
    const whatsapp = document.getElementById('whatsapp').value.trim();
    if(name || whatsapp) {
      db.ref('users').push({ name, whatsapp });
    }
    // stop placeholder animations
    try { nameTyper.stop(); waTyper.stop(); } catch(_){}
    intro.style.display = 'none';
    chatUI.style.display = 'flex';
    // Show Instagram icon only after entering chat
    if (instaFloat) { instaFloat.style.display = 'grid'; instaFloat.setAttribute('aria-hidden','false'); }
    if (lbFloat) { lbFloat.style.display = 'grid'; }
    currentUserName = name || 'Anonymous';
    // Greet by name on start
    const displayName = name || 'friend';
    speak(`Hello ${displayName}, You're awesome!`);
    // Personalized welcome
    const welcome = document.createElement('div');
    welcome.className = 'message bot';
    chatContainer.appendChild(welcome);
    typingEffect(welcome, `Namaste ${displayName}! üëã\nAap IITM BS in Data Science ke baare mein kuch bhi pooch sakte hain ‚Äî admissions, eligibility, courses, credits, fees, timelines, exams, project, placements, aur guidance. Main madad ke liye yahan hoon. üòä\nShuru karein?`);
  };

  // Leaderboard helpers (Firebase with localStorage fallback)
  function safeKey(name) { return (name || 'Anonymous').replace(/[^a-z0-9_\-]/gi, '_'); }
  function updateBadge() { if (lbBadge) lbBadge.textContent = String(sessionMsgCount); }
  function incrementLeaderboard(name) {
    const key = safeKey(name);
    try {
      const ref = db.ref('leaderboard').child(key);
      ref.transaction(curr => (curr || 0) + 1);
    } catch (_) {
      // Fallback local leaderboard
      const raw = localStorage.getItem('leaderboard') || '{}';
      const obj = JSON.parse(raw);
      obj[key] = (obj[key] || 0) + 1;
      localStorage.setItem('leaderboard', JSON.stringify(obj));
    }
  }
  function fetchTopLeaderboard(limit=10) {
    return new Promise((resolve) => {
      try {
        // Fetch all for client-side pagination
        db.ref('leaderboard').orderByValue().once('value').then(snap => {
          const vals = snap.val() || {};
          const arr = Object.entries(vals).map(([name,count]) => ({ name, count })).sort((a,b)=>b.count-a.count);
          resolve(arr);
        }).catch(()=>{
          const raw = localStorage.getItem('leaderboard') || '{}';
          const obj = JSON.parse(raw);
          const arr = Object.entries(obj).map(([name,count]) => ({ name, count })).sort((a,b)=>b.count-a.count);
          resolve(arr);
        });
      } catch (_) {
        const raw = localStorage.getItem('leaderboard') || '{}';
        const obj = JSON.parse(raw);
        const arr = Object.entries(obj).map(([name,count]) => ({ name, count })).sort((a,b)=>b.count-a.count);
        resolve(arr);
      }
    });
  }
  function renderLeaderboardPage() {
    lbList.innerHTML = '';
    const total = lbAllRows.length;
    const pages = Math.max(1, Math.ceil(total / lbPageSize));
    if (lbPage >= pages) lbPage = pages - 1;
    const start = lbPage * lbPageSize;
    const slice = lbAllRows.slice(start, start + lbPageSize);
    slice.forEach((row, idx) => {
      const li = document.createElement('li');
      const globalRank = start + idx + 1;
      const medal = globalRank === 1 ? 'ü•á' : globalRank === 2 ? 'ü•à' : globalRank === 3 ? 'ü•â' : `${globalRank}.`;
      li.innerHTML = `<span>${medal} ${row.name}</span><strong>${row.count}</strong>`;
      lbList.appendChild(li);
    });
    if (!slice.length) {
      const li = document.createElement('li');
      li.textContent = 'No entries yet. Start chatting!';
      lbList.appendChild(li);
    }
    if (lbPageInfo) lbPageInfo.textContent = `Page ${Math.min(lbPage+1, pages)}/${pages}`;
    if (lbPrev) lbPrev.disabled = lbPage <= 0;
    if (lbNext) lbNext.disabled = lbPage >= pages - 1;
  }
  function openLeaderboard() {
    if (!lbModal) return;
    lbModal.style.display = 'flex';
    fetchTopLeaderboard().then(rows => { lbAllRows = rows; lbPage = 0; renderLeaderboardPage(); });
    // focus close for accessibility
    if (lbClose) lbClose.focus();
  }
  if (lbFloat) lbFloat.addEventListener('click', openLeaderboard);
  if (lbClose) lbClose.addEventListener('click', ()=> lbModal.style.display = 'none');
  if (lbModal) lbModal.addEventListener('click', (e)=>{ if(e.target === lbModal) lbModal.style.display = 'none'; });
  if (lbPrev) lbPrev.addEventListener('click', ()=>{ if (lbPage>0) { lbPage--; renderLeaderboardPage(); } });
  if (lbNext) lbNext.addEventListener('click', ()=>{ lbPage++; renderLeaderboardPage(); });

  // Global Esc to close modals
  window.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') {
      if (lbModal && lbModal.style.display === 'flex') lbModal.style.display = 'none';
      if (shareGate && shareGate.style.display === 'flex') hideShareGate();
    }
  });
  // Stop background sounds/placeholder on tab hide
  document.addEventListener('visibilitychange', ()=>{
    if (document.hidden) {
      try { stopTypingSound(); nameTyper.stop(); waTyper.stop(); } catch(_){}
    }
  });

  const chatContainer = document.getElementById('chat-container');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  // Share-gate and learn
  let userMsgCount = 0;
  let hasShared = false;
  const shareGate = document.getElementById('share-gate');
  const btnShare = document.getElementById('btn-share');
  const btnShared = document.getElementById('btn-shared');
  const btnCloseGate = document.getElementById('btn-close-gate');
  const btnLearnYes = document.getElementById('btn-learn-yes');
  function showShareGate(){ shareGate.style.display = 'flex'; }
  function hideShareGate(){ shareGate.style.display = 'none'; }
  btnShare.onclick = () => {
    const shareText = encodeURIComponent('Try this IITM BS Data Science AI helper. Ask anything about admissions, courses, fees, and more!');
    const shareUrl = encodeURIComponent(window.location.href);
    const wa = `https://api.whatsapp.com/send?text=${shareText}%20${shareUrl}`;
    window.open(wa, '_blank');
  };
  btnShared.onclick = () => {
    hasShared = true;
    hideShareGate();
    addMessage('Thank you for sharing! You can continue chatting now. üôå', 'bot');
  };
  btnCloseGate.onclick = () => {
    hideShareGate();
    addMessage('You can share anytime to unlock full access. üòä', 'bot');
  };
  btnLearnYes.onclick = () => {
    const msg = encodeURIComponent('Hello Prabhav! I saw your AI chatbot project and I also want to learn how you made it ‚Äî that was awesome!');
    window.open(`https://wa.me/918218959363?text=${msg}`, '_blank');
  };

  function addMessage(text, sender) {
    const msg = document.createElement('div');
    msg.className = 'message ' + sender;
    msg.innerHTML = text;
    chatContainer.appendChild(msg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  function typingEffect(element, text, callback) {
    let i=0;
    element.innerHTML = '';
    const interval = setInterval(() => {
      element.innerHTML += text.charAt(i);
      i++;
      if(i>=text.length) { clearInterval(interval); if(callback) callback(); }
    }, 20);
  }

  sendBtn.onclick = sendMessage;
  userInput.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });

  // Sound FX (Web Audio)
  let audioCtx = null;
  function ensureAudio() {
    if (!audioCtx) {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if (!Ctx) return null;
      audioCtx = new Ctx();
    }
    if (audioCtx.state === 'suspended') audioCtx.resume();
    return audioCtx;
  }
  function playTone(freq=520, durationMs=120, volume=0.05) {
    const ctx = ensureAudio();
    if (!ctx) return;
    const now = ctx.currentTime;
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(freq, now);
    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.exponentialRampToValueAtTime(volume, now + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + durationMs/1000);
    osc.connect(gain).connect(ctx.destination);
    osc.start(now);
    osc.stop(now + durationMs/1000 + 0.02);
  }
  function playUiSound(kind) {
    // Subtle iOS-like cues
    const ctx = ensureAudio();
    if (!ctx) return;
    const t0 = ctx.currentTime;
    if (kind === 'send') {
      // quick up chime: 660 -> 880
      setTimeout(()=>playTone(660, 80, 0.05), 0);
      setTimeout(()=>playTone(880, 80, 0.045), 70);
    } else if (kind === 'receive') {
      // soft down-up notification: 880 -> 520
      setTimeout(()=>playTone(880, 90, 0.045), 0);
      setTimeout(()=>playTone(520, 120, 0.05), 80);
    } else if (kind === 'error') {
      // brief low blip
      setTimeout(()=>playTone(320, 140, 0.05), 0);
    }
  }
  let typingSoundTimer = null;
  function startTypingSound() {
    if (typingSoundTimer) return;
    // soft blip every 500ms while typing
    typingSoundTimer = setInterval(() => playTone(420, 30, 0.02), 500);
  }
  function stopTypingSound() {
    if (typingSoundTimer) {
      clearInterval(typingSoundTimer);
      typingSoundTimer = null;
    }
  }

  // Jarvis-like voice greeting (Web Speech API)
  let firstGreetingDone = false;
  function pickFemaleEnglishVoice() {
    if (!window.speechSynthesis) return null;
    const voices = window.speechSynthesis.getVoices();
    const preferred = ['Google UK English Female','Google US English','Samantha','Victoria','Allison','Joanna','Tessa','Veena','Serena','Moira'];
    const byName = voices.find(v => preferred.some(n => v.name && v.name.toLowerCase().includes(n.toLowerCase())));
    if (byName) return byName;
    const enVoices = voices.filter(v=>/en/i.test(v.lang));
    return enVoices[0] || voices[0] || null;
  }
  function speak(text, opts={}) {
    if (!window.speechSynthesis) return;
    const u = new SpeechSynthesisUtterance(text);
    u.pitch = opts.pitch != null ? opts.pitch : 1.02; // slightly higher for a female tone
    u.rate = opts.rate != null ? opts.rate : 0.98;
    u.volume = opts.volume != null ? opts.volume : 1;
    const v = pickFemaleEnglishVoice();
    if (v) u.voice = v;
    try { window.speechSynthesis.cancel(); } catch(_){}
    window.speechSynthesis.speak(u);
  }
  function playGreeting() {
    if (firstGreetingDone) return;
    firstGreetingDone = true;
    // tiny earcon then speech
    try { if (window.speechSynthesis) window.speechSynthesis.resume(); } catch(_){}
    playUiSound('receive');
    setTimeout(()=>{
      speak('This AI chatbot is made by Prabhav. Click on Start Chat to proceed.');
    }, 120);
  }
  window.addEventListener('load', ()=>{
    try { if (window.speechSynthesis) window.speechSynthesis.getVoices(); } catch(_){}
    setTimeout(playGreeting, 2000);
    // If voices load late, try once more
    if (window.speechSynthesis) {
      window.speechSynthesis.onvoiceschanged = ()=>{ if (!firstGreetingDone) playGreeting(); };
    }
    if (window.speechSynthesis) {
      window.speechSynthesis.onvoiceschanged = ()=>{ if (!firstGreetingDone) playGreeting(); };
    }
    // Fallback: first user interaction (in case autoplay is blocked)
    const firstInteract = ()=>{ if (!firstGreetingDone) playGreeting(); document.removeEventListener('pointerdown', firstInteract, true); };
    document.addEventListener('pointerdown', firstInteract, true);
  });

  const knowledgeText = `



`; // Use your data

  // Pollinations OpenAI-compatible config (per APIDOCS.md)
  const POLL_ENDPOINT = 'https://text.pollinations.ai/openai';
  const POLL_MODEL = 'openai'; // or another from https://text.pollinations.ai/models
  const POLL_REFERRER = window.location.origin; // improves limits if registered
  // Minimal client-side pacing to respect tier limits
  let lastPollRequestAt = 0;
  const MIN_POLL_INTERVAL_MS = 4000; // 4s between requests (Seed ~5s, Flower ~3s)

  async function sendMessage() {
    const question = userInput.value.trim();
    if (!question) return;
    // Gate after 2 user messages until sharing
    userMsgCount += 1;
    if (userMsgCount > 2 && !hasShared) {
      showShareGate();
      return;
    }
    addMessage(question, 'user');
    // Send sound
    playUiSound('send');
    // Leaderboard counting: per-user and badge
    sessionMsgCount += 1; updateBadge(); incrementLeaderboard(currentUserName);
    userInput.value = '';
    // Disable send while awaiting response
    sendBtn.disabled = true; userInput.disabled = true;
    const botMsg = document.createElement('div');
    botMsg.className = 'message bot';
    botMsg.innerHTML = '<span class="typing">ü§ñ Typing...</span>';
    chatContainer.appendChild(botMsg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    // Start typing sound loop
    startTypingSound();

    try {
        // Respect minimal interval before calling Pollinations
        const now = Date.now();
        const waitMs = Math.max(0, MIN_POLL_INTERVAL_MS - (now - lastPollRequestAt));
        if (waitMs > 0) await new Promise(r => setTimeout(r, waitMs));
        lastPollRequestAt = Date.now();

        // Pollinations OpenAI-compatible chat API
        const response = await fetch(POLL_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            model: POLL_MODEL,
            messages: [
              { role: 'system', content: 'You are a helpful, friendly AI for IITM BS Data Science students.' },
              { role: 'user', content: question + '\nCourse data:\n' + knowledgeText }
            ],
            private: false,
            referrer: POLL_REFERRER
          })
        });

        const data = await response.json();
        if (!response.ok) {
            const msg = (data && data.error && data.error.message) ? data.error.message : (response.statusText || 'Unknown error');
            throw new Error(msg);
        }
        const answer = (data && data.choices && data.choices[0] && (data.choices[0].message && data.choices[0].message.content || data.choices[0].text)) || '';
        if (!answer) throw new Error('No answer returned from model');
        // Stop typing sfx and play receive
        stopTypingSound();
        playUiSound('receive');
        typingEffect(botMsg, 'ü§ñ ' + answer);
        // Re-enable input
        sendBtn.disabled = false; userInput.disabled = false; userInput.focus();
    } catch(e) {
        stopTypingSound();
        playUiSound('error');
        typingEffect(botMsg, 'ü§î Sorry, AI is unavailable.');
        console.error(e);
        // Re-enable input
        sendBtn.disabled = false; userInput.disabled = false; userInput.focus();
    }
  }
</script>
</body>
</html>

